---
name: sql-audit
description: SQL工单自动审核工具。自动登录SQL审核系统，查找指定组别且状态为"等待审核人审核"的工单，并自动点击审核通过。支持批量审核多个符合条件的工单。
trigger: 仅当用户明确说"审核工单"、"审核SQL"、"审个工单"时触发。
---

# SQL工单自动审核技能

## 技能目标

自动登录SQL审核系统，查找指定组别和状态的工单，并依次点击审核通过。

## 前置条件

1. 已配置环境变量文件 `.env`（必填项：URL、用户名、密码）
2. 有访问SQL审核系统的权限
3. 有审核目标组别工单的权限
4. OpenClaw 浏览器服务已启动

> 💡 **配置说明：** 详细配置步骤请查看 `README.md`

## 工作流程

### 1. 加载配置

从 `.env` 文件读取配置：
- URL、用户名、密码（必填）
- 组别、状态（可选，有默认值）
- 超时时间、等待时间等（可选）

**验证：** 检查必填项是否完整，缺失时提示用户配置。

### 2. 打开页面

使用浏览器自动化工具打开目标URL（从配置读取）。

等待页面加载完成。

### 3. 自动登录（如需要）

**检测登录状态：**
- 检查是否出现登录表单
- 已登录则跳过此步骤

**登录流程：**
1. 填入用户名
2. 填入密码
3. 点击登录按钮
4. 等待登录完成

**错误处理：** 登录失败时提示检查凭据。

### 4. 查找工单

在页面上定位符合以下条件的工单：
- **组别** = 配置中的目标组别（默认：HERMES市场-HERMES_KOL）
- **状态** = 配置中的目标状态（默认：等待审核人审核）

**查找策略：**
- 识别表格结构
- 按列筛选
- 文本匹配定位

### 5. 处理工单

**场景A：无符合条件的工单**
- 输出提示信息
- 结束任务

**场景B：有符合条件的工单**
- 统计工单数量
- 对每个工单执行：
  1. 点击工单名称进入详情
  2. 等待详情页加载
  3. 点击"审核通过"按钮
  4. 等待审核完成
  5. 返回列表继续下一个

### 6. 输出结果

汇报审核摘要：
- 成功审核的工单数量
- 工单名称/ID列表
- 失败的工单（如有）

## 技术要点

### 选择器策略

- **工单列表**：优先使用 `table` 或包含 `list`/`workflow` 的容器
- **工单行**：文本匹配 + DOM 结构
- **审核按钮**：匹配"审核通过"、"通过"、"approve"等关键词

### 等待策略

- 页面加载：等待网络空闲或关键元素出现
- 操作间隔：配置可调，避免操作过快

### 错误处理

- 页面未加载：超时后重试一次
- 元素定位失败：提示页面结构可能变化
- 审核失败：记录并继续下一个
- 权限不足：提示需要相应权限

## 使用示例

触发技能后，会自动：
1. 读取 `.env` 配置
2. 打开 SQL 审核系统
3. 自动登录
4. 查找并审核符合条件的工单
5. 汇报审核结果

## 消息输出策略

**严格规则：永远只发送2条消息，绝不多发**

### 执行顺序（严格遵守）

1. **第一步：立即发送确认消息**
   - 使用 `message` 工具发送到当前对话
   - 内容固定：`"收到，开始审核SQL工单..."`
   - **这一步必须在任何其他工具调用之前完成**
   - 目的：让用户知道请求已接收，正在处理

2. **第二步：执行任务**
   - 读取配置
   - 浏览器操作
   - **所有操作静默执行，绝不发送任何中间状态或错误提示**

3. **第三步：发送汇总消息（仅此1条）**
   - 在任务完成后发送最终结果
   - 内容：成功审核的工单数量、工单名称列表、失败工单信息（如有）

### 消息内容规范

**确认消息（第1条）：**
- 固定内容：`收到，开始审核SQL工单...`
- 不允许任何变化或补充

**汇总消息（第2条）：**
格式示例：
✅ SQL工单审核完成
审核结果：
	成功审核：x 个工单
	审核失败：0 个
工单列表：
	1. 测试66 
	2. xxx

**绝对禁止：**
- ❌ 任何中间状态消息
- ❌ 任何错误提示消息
- ❌ 任何进度更新消息
- ❌ 任何额外说明或警告

**原则：**
- **用户只收到2条消息：确认 + 汇总**
- **即使遇到错误，也只在汇总消息中说明，绝不单独发送错误提示**
- **确认消息必须先发，然后再执行任务**

## 注意事项

1. 仅审核配置文件中指定的组别和状态
2. 建议在非高峰期使用
3. 审核操作会记录日志，可追溯
4. 如遇页面结构变化，可能需要更新选择器策略
