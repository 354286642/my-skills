---
name: code-review-update
description: "根据code-review的审查优化建议，进行代码修复"
---

## 工作流程

### 1. 从对话历史中提取评审问题
   - 问题类型（bug、性能、安全、规范、可读性等）
   - 问题位置（文件路径:行号）
   - 问题描述
   - 建议的修复方案

### 2. 问题分类与优先级
按优先级排序处理：
- **P0 - 必须修复**：安全漏洞、严重 bug、资源泄漏
- **P1 - 应该修复**：性能问题、逻辑错误
- **P2 - 建议修复**：代码规范、可读性、重构建议

### 3. 自动修复策略
以下类型的问题**可以自动修复**：
- 简单的代码规范问题（格式、命名）
- 明显的逻辑错误（如 == vs ===）
- 简单的性能优化（如去除重复计算）
- 未使用的变量/导入
- 缺失的错误处理

以下问题**需要用户确认**：
- 影响业务逻辑的修改
- API 接口变更
- 数据结构变更
- 大范围重构

**不进行修复**的问题：
- 需要业务知识判断的问题
- 架构层面的重大变更
- 测试相关的建议（仅报告）

### 4. 修复执行
- 读取目标文件
- 使用 Edit 工具进行精确修改
- 保留原有代码风格和格式
- 单次修改只处理一个文件

### 5. 修复验证
- 修复后简要说明修改内容
- 列出已修复的问题清单
- 标记需要用户确认的问题

---

## 输出格式

### 无需处理时
```
当前没有需要修复的代码问题。
```

### 有修复时
```
✅ 修复完成

已修复以下问题：
1. [文件:行号] 问题类型 - 问题描述
2. ...

---

以下问题需要用户确认后处理：
1. [文件:行号] 问题类型 - 问题描述及影响
```

### 全部需要确认时
```
发现以下需要确认的问题：

1. [文件:行号] 问题类型
   - 问题描述
   - 建议修复：...
   - 风险：...

请明确指定要修复的问题编号。
```

---

## 注意事项
- 修复前必须先 Read 文件，确保理解上下文
- 保守修复，只改必要部分
- 修复后不主动运行测试（除非用户明确要求）
- 如发现修复风险较大，优先报告而非自动修复